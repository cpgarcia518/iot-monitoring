[agent]
  interval = "10m"           # Match API polling interval
  round_interval = true      # Align with :00, :10, :20 timestamps
  flush_interval = "60s"     # Balance between urgency and bulk writes
  flush_jitter = "5s"        # Prevent thundering herd on InfluxDB
  collection_jitter = "30s"  # Randomize start within this window
  precision = "ns"           # Critical for exact HOBO timestamps

# INPUT: HOBO API via Custom Script
[[inputs.exec]]
  commands = [
    "/opt/telegraf/scripts/hobolink_to_influx.sh ${HOBO_API_TOKEN}" # Use ENV var for security
  ]
  timeout = "9m"             # Must be <10m interval
  interval = "10m"           # Sync with agent interval
  
  ## Environment variables
  ## Array of "key=value" pairs to pass as environment variables
  ## e.g. "KEY=value", "USERNAME=John Doe",
  ## "LD_LIBRARY_PATH=/opt/custom/lib64:/usr/local/libs"
  # environment = []

  ## measurement name suffix (for separating different commands)
  # name_suffix = "_mycollector"

  ## Data format to consume.
  ## Each data format has its own unique set of configuration options, read
  ## more about them here:
  ## https://github.com/influxdata/telegraf/blob/master/docs/DATA_FORMATS_INPUT.md
  data_format = "influx"     # Matches script's line protocol output

  # Add metadata tags to all metrics
  [inputs.exec.tags]
    manufacturer = "hobo"    # Consistent with bucket labels
    data_source = "api"      # api/sd_card/lorawan
    deployment = "field"     # field/lab/commercial

# OUTPUT: InfluxDB v2
[[outputs.influxdb_v2]]
  urls = ["https://influxdb2:8086"]
  token = "$INFLUX_TOKEN"    # Use environment variable
  organization = "$INFLUXDB_ORG"
  bucket = "$INFLUXDB_BUCKET" # Use environment variable
  
  # Explicit bucket tagging (matches your labels)
  [outputs.influxdb_v2.tagpass]
    manufacturer = ["hobo"]
    data_source = ["api"]
  
  # Connection tuning
  timeout = "10s"
  insecure_skip_verify = false # Set true if using self-signed cert

  ## The value of this tag will be used to determine the bucket.  If this
  ## tag is not set the 'bucket' option is used as the default.
  # bucket_tag = ""

  ## If true, the bucket tag will not be added to the metric.
  # exclude_bucket_tag = false

  ## Timeout for HTTP messages.
  # timeout = "5s"

  ## HTTP Proxy override, if unset values the standard proxy environment
  ## variables are consulted to determine which proxy, if any, should be used.
  # http_proxy = "http://corporate.proxy:3128"

  ## HTTP User-Agent
  # user_agent = "telegraf"

  ## Content-Encoding for write request body, can be set to "gzip" to
  ## compress body or "identity" to apply no encoding.
  # content_encoding = "gzip"

  ## Enable or disable uint support for writing uints influxdb 2.0.
  # influx_uint_support = false

  ## Optional TLS Config for use on HTTP connections.
  # tls_ca = "/etc/telegraf/ca.pem"
  # tls_cert = "/etc/telegraf/cert.pem"
  # tls_key = "/etc/telegraf/key.pem"
  ## Use TLS but skip chain & host verification
  # insecure_skip_verify = false


# OPTIONAL: Telegraf Self-Monitoring
[[inputs.internal]]
  collect_memstats = true

[[outputs.file]]
  files = ["stdout"]         # Debug output
  data_format = "influx"